# [TIL] 2020-03-29

π”‘ : μ¤ν”„λ§ λ¶€νΈ

## π“” μ²μ λ°°μ°λ” μ¤ν”„λ§ λ¶€νΈ 2
### π“ 2μ¥: μ¤ν”„λ§ λ¶€νΈ ν™κ²½μ„¤μ •
#### β… YAML νμΌ λ§¤ν•‘ν•κΈ°
* `@Value` : νΉμ •ν• κ°’μ„ νΈμ¶ν•  μ μμ. ν‚¤λ¥Ό μ •ν™•ν μ…λ ¥ν•΄μ•Ό ν•κ³ , ν‚¤κ°€ μ—†μ„ κ²½μ°λ¥Ό κ³ λ ¤ν• μμ™Έμ²λ¦¬κ°€ ν•„μ”, μ£Όλ΅ λ‹¨μΌ ν•„λ“κ°’μ„ κ°€μ Έμ¤λ”λ° μ‚¬μ©
	* `@Value(β€${property.test.name}β€)` : κΉμ΄κ°€ μ΅΄μ¬ν•λ” ν‚¤κ°’μ— λ€ν•΄ β€.β€™λ΅ κµ¬λ¶„ν•μ—¬ ν•΄λ‹Ή κ°’μ„ λ§¤ν•‘
	* `@Value(β€${propertyTest}β€)` : λ‹¨μΌ ν‚¤κ°’μ„ λ§¤ν•‘
	* `@Value(β€${noKey:default value}β€)` : YAML νμΌμ— ν‚¤κ°€ μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ λ””ν΄νΈκ°’μ΄ λ§¤ν•‘λλ„λ΅ μ„¤μ •
	* `@Value(β€${propertyTestList}β€)` :  μ—¬λ¬ κ°’μ„ λ‚μ—΄ν• κ²½μ°, λ°°μ—΄ν•μΌλ΅ λ§¤ν•‘
	* `@Value(β€#{β€${propertyTestList}β€™.split(β€,β€™)}β€)` : SpEL(`@Value`μ—μ„ μ μΌν•κ² μ§€μ›λλ” κΈ°λ¥)μ„ μ‚¬μ©ν•΄μ„ β€,β€™λ¥Ό κΈ°μ¤€μΌλ΅ Listμ— λ§¤ν•‘
* `@ConfigurationProperties` : List, Map λ“± λ‹¤μ–‘ν• μλ£κµ¬μ΅°λ΅ ν”„λ΅νΌν‹° κ°’μ„ λ§¤ν•‘ν•  μ μμ. κΈ°λ³Έμ μΌλ΅ μ ‘λ‘μ‚¬(prefix)λ¥Ό μ‚¬μ©ν•΄μ„ λ°”μΈλ”©
	* `@ConfigurationProperties`λ¥Ό μ‚¬μ©ν•λ ¤λ©΄ ν•΄λ‹Ή ν΄λμ¤λ¥Ό `@Component`λ΅ μ„ μ–Έν•΄μ•Ό ν•¨
	* κΈ°λ³Έ μ»¬λ ‰μ… νƒ€μ…(Map, List λ“±) λΏλ§ μ•„λ‹λΌ POJO(Plain Old Java Object) νƒ€μ… λ§¤ν•‘λ„ μ κ³µν•¨
	* Map νƒ€μ… μλ£κµ¬μ΅°λ³΄λ‹¤ POJO νƒ€μ…μ΄ λ” μ§κ΄€μ μ΄κ³  λ…ν™•ν•κ² κ°μ²΄λ¥Ό κµ¬μ„±ν•  μ μμ
	* **μ μ—°ν• λ°”μΈλ”©** : ν”„λ΅νΌν‹° κ°’μ„ κ°μ²΄μ— λ°”μΈλ”©ν•  κ²½μ° ν•„λ“λ¥Ό λ‚™νƒ€ ν‘κΈ°λ²•μΌλ΅ μ„ μ–Έν•κ³ , ν‚¤λ” λ‹¤μ–‘ν• ν•μ‹(λ‚™νƒ€ ν‘κΈ°λ²•, μΌ€λ°¥ ν‘κΈ°λ²•, μ–Έλ”λ°” ν‘κΈ°λ²• λ“±)μΌλ΅ μ„ μ–Έν•μ—¬ λ°”μΈλ”© ν•  μ μλ” κ²ƒμ„ λ§ν•¨. `color-name`, `color_name`, `colorName`, `colorname` λ¨λ‘ `colorName` ν•„λ“μ— λ°”μΈλ”©λ¨
* **λ΅¬λ³µ μμ΅΄μ„± μ„¤μ •** : `build.gradle`μ— μ¶”κ°€ν•  λ•, `compileOnly`λ΅ μ¶”κ°€ν•λ‹¤. λ΅¬λ³µ μ–΄λ…Έν…μ΄μ…μ€ μ»΄νμΌ μ‹ ν•„μ”ν• μ½”λ“λ¥Ό μ¶”κ°€ν•  λ•λ§ μ‚¬μ©λκΈ° λ•λ¬Έμ— λ°νƒ€μ„μ—μ„λ” μμ΅΄μ„±μ΄ ν•„μ”ν•μ§€ μ•μ.

#### β… μλ™ ν™κ²½ μ„¤μ • μ΄ν•΄ν•κΈ°
* μƒλ΅ μ¶”κ°€λλ” λΌμ΄λΈλ¬λ¦¬(JAR)λ” μ¤ν”„λ§ λ¶€νΈ μλ™-μ„¤μ • μμ΅΄μ„±μ— λ”°λΌμ„ μ„¤μ •μ΄ μλ™ μ μ©λ¨
* `@EnableAutoConfiguration`, `@SpringBootApplication` μ¤‘ ν•λ‚μ μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©
* κΈ°μ΅΄μ μ¤ν”„λ§ ν”„λ μ„μ›ν¬λ” μμ΅΄μ„±μ„ λΉμΌλ΅ μ„¤μ •
* μ¤ν”„λ§ λ¶€νΈλ” κ΄€λ ¨ μμ΅΄μ„±μ„ μ¤νƒ€ν„°λΌλ” λ¬¶μμΌλ΅ μ κ³µν•κ³ , μλ™ μ„¤μ •μ„ μ§€μ–‘ν•¨
* `@SpringBootConfiguration` : μ¤ν”„λ§ λ¶€νΈμ μ„¤μ •μ„ λ‚νƒ€λ‚΄λ” μ–΄λ…Έν…μ΄μ…. μ¤ν”„λ§μ `@Configuration`μ„ λ€μ²΄ν•λ©° μ¤ν”„λ§ λ¶€νΈ μ „μ©μΌλ΅ μ‚¬μ©ν•¨. ν•„μμ μΈ μ–΄λ…Έν…μ΄μ… μ¤‘ ν•λ‚.
* `@EnableAutoConfiguration` : μλ™ μ„¤μ •μ ν•µμ‹¬ μ–΄λ…Έν…μ΄μ…. ν΄λμ¤ κ²½λ΅μ— μ§€μ •λ λ‚΄μ©μ„ κΈ°λ°μΌλ΅ μ„¤μ • μλ™ν™”λ¥Ό μν–‰. νΉλ³„ν• μ„¤μ • κ°’μ„ μ¶”κ°€ν•μ§€ μ•μΌλ©΄ κΈ°λ³Έ κ°’μΌλ΅ λ™μ‘
* `@ComponentScan` : νΉμ • ν¨ν‚¤μ§€ κ²½λ΅λ¥Ό κΈ°λ°μΌλ΅ `@Configuration`μ—μ„ μ‚¬μ©ν•  `@Component` μ„¤μ • ν΄λμ¤λ¥Ό μ°Ύμ. `basePackages` κ°’μ— λ³„λ„μ κ²½λ΅λ¥Ό μ„¤μ •ν•μ§€ μ•μΌλ©΄ `@ComponentScan`μ΄ μ„μΉν• ν¨ν‚¤μ§€κ°€ λ£¨νΈ κ²½λ΅λ΅ μ„¤μ •λ¨
* `@SpringBootApplication` : `@SpringBootConfiguration` + `@EnableAutoConfiguration` + `@ComponentScan` μ–΄λ…Έν…μ΄μ… μ΅°ν•©

#### β… `@EnableAutoConfiguration`
```java
// @EnableAutoConfiguration
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {
  β€¦
}
```
* `@Import(AutoConfigurationImportSelector.class)` : μλ™ μ„¤μ •μ„ μ§€μ›ν•΄μ£Όλ” μ–΄λ…Έν…μ΄μ…
* `AutoConfigurationImportSelector` : μ¤λ²„λΌμ΄λ“ λ°›μ€ `selectImports()` λ©”μ„λ“κ°€ μλ™ μ„¤μ •ν•  λΉμ„ κ²°μ •
	* `META-INF/spring.factories`μ— μ •μλ μλ™ μ„¤μ •ν•  ν΄λμ¤λ“¤μ„ λ¨Όμ € λ¶λ¬μ΄
	* λ€λµ 100μ—¬ κ° μ •λ„μ μ„¤μ •μ΄ λ―Έλ¦¬ μ •μλμ–΄ μμ
	* μ¤ν”„λ§ λ¶€νΈ μ¤νƒ€ν„°λ¥Ό μ—¬λ¬ κ° λ“±λ΅ν•΄μ„ μ‚¬μ©ν•  κ²½μ°, λ‚΄λ¶€μ— μ¤‘λ³µλ λΉμ΄ μ„¤μ •λ  κ²½μ°κ°€ λΉλ²ν•¨. μ΄λ° κ²½μ°λ¥Ό μ„ν•΄ μ μ™Έν•  μ„¤μ •κ³Ό μ¤‘λ³µλ μ„¤μ •μ„ μ μ™Έν•¨
* `META-INF/spring.factories` : μλ™ μ„¤μ • νƒ€κΉƒ ν΄λμ¤ λ©λ΅
* `META-INF/spring-configuration-metadata.json` : μλ™ μ„¤μ •μ— μ‚¬μ©ν•  ν”„λ΅νΌν‹° μ •μ νμΌ
* `org/springframework/boot/autoconfigure` : λ―Έλ¦¬ κµ¬ν„ν•΄ λ‘” μλ™ μ„¤μ • λ¦¬μ¤νΈ
	* λ„¤μ΄λ° : `{νΉμ • μ„¤μ •μ μ΄λ¦„}AutoConfiguration` ν•μ‹μΌλ΅ μ§€μ •λμ–΄ μμ
	* μλ°” μ„¤μ • λ°©μ‹μ„ λ”°λ¦„
* `application.yml`μ— ν”„λ΅νΌν‹° κ°’μ„ μ¶”κ°€ν•λ©΄ μλ™ ν™κ²½ μ„¤μ •μ— μλ™μΌλ΅ μ μ©λμ–΄ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹¤ν–‰λ¨
* μ¤ν”„λ§ ν”„λ΅νΌν‹° λ¬Έμ„λ¥Ό μ‚¬μ©ν•λ©΄ λ” μ‰½κ² ν”„λ΅νΌν‹° κ°’μ„ ν™•μΈν•  μ μμ

### π“ 3μ¥: μ¤ν”„λ§ λ¶€νΈ ν…μ¤νΈ
μ¤ν”„λ§ λ¶€νΈλ” κΈ°λ³Έμ μΈ ν…μ¤νΈ μ¤νƒ€ν„°λ¥Ό μ κ³µν•¨
* `spring-boot-test`, `spring-boot-test-autoconfigure` λ¨λ“λ΅ κµ¬μ„±λμ–΄ ν…μ¤νΈ κ΄€λ ¨ μλ™ μ„¤μ • κΈ°λ¥μ„ μ κ³µν•¨
* μΌλ°μ μΌλ΅ `spring-boot-starter-test`λ΅ λ‘ λ¨λ“μ„ ν•¨κ» μ‚¬μ©ν•¨

#### β… `@SpringBootTest`
ν†µν•© ν…μ¤νΈλ¥Ό μ κ³µν•λ” κΈ°λ³Έμ μΈ μ¤ν”„λ§ λ¶€νΈ ν…μ¤νΈ μ–΄λ…Έν…μ΄μ…
* μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‹¤ν–‰λ  λ•μ μ„¤μ •μ„ μ„μλ΅ λ°”κΎΈμ–΄ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•  μ μμ
* μ—¬λ¬ λ‹¨μ„ ν…μ¤νΈλ¥Ό ν•λ‚μ ν†µν•©λ ν…μ¤νΈλ΅ μν–‰ν•  λ• μ ν•©
* μ¤ν”„λ§ λ¶€νΈ 1.4 λ²„μ „λ¶€ν„° μ κ³µλλ©°, μ¤ν”„λ§ λ¶€νΈ ν”„λ΅μ νΈλ¥Ό λ§λ“¤λ©΄ λ©”μΈ ν΄λμ¤μ™€ ν•¨κ» κΈ°λ³ΈμΌλ΅ μ κ³µ
* μ‹¤μ  κµ¬λ™λλ” μ• ν”λ¦¬μΌ€μ΄μ…κ³Ό λ‘κ°™μ΄ μ• ν”λ¦¬μΌ€μ΄μ… μ»¨ν…μ¤νΈλ¥Ό λ΅λ“ν•΄ ν…μ¤νΈν•κΈ° λ•λ¬Έμ—, ν•κ³  μ‹¶μ€ ν…μ¤νΈλ¥Ό λ¨λ‘ μν–‰ν•  μ μμ (μ• ν”λ¦¬μΌ€μ΄μ… κ·λ¨κ°€ ν΄μλ΅ λλ ¤μ§)
* `@RunWith` : JUnitμ— λ‚΄μ¥λ λ¬λ„λ¥Ό μ‚¬μ©ν•λ” λ€μ‹ , μ–΄λ…Έν…μ΄μ…μ— μ •μλ λ¬λ„ ν΄λμ¤λ¥Ό μ‚¬μ©
	* `SpringRunner.class`λ¥Ό λ¶™μ΄μ§€ μ•μΌλ©΄ μ •μƒ λ™μ‘ν•μ§€ μ•μ

#### β… `@WebMvcTest`
μ›Ήμ—μ„ ν…μ¤νΈν•κΈ° νλ“  μ»¨νΈλ΅¤λ¬λ¥Ό ν…μ¤νΈν•λ” λ° μ ν•©ν•λ©°, μ”μ²­κ³Ό μ‘λ‹µμ— λ€ν•΄ ν…μ¤νΈ
* μ‹νλ¦¬ν‹° νΉμ€ ν•„ν„°κΉμ§€ μλ™μΌλ΅ ν…μ¤νΈν•λ©° μλ™μΌλ΅ μ¶”κ°€/μ‚­μ κ°€ κ°€λ¥
* MVC κ΄€λ ¨ μ„¤μ •μΈ `@Controller`, `@ControllerAdvice`, `@JsonComponent`, Filter, WebMvcConfigurer, HandlerMethodArgumentResolverλ§ λ΅λ“λκΈ° λ•λ¬Έμ— `@SpringBootTest`λ³΄λ‹¤ κ°€λ³κ² ν…μ¤νΈ ν•  μ μμ

#### β… `@DataJpaTest`
JPA κ΄€λ ¨ ν…μ¤νΈ μ„¤μ •λ§ λ΅λ“. λ°μ΄ν„°μ†μ¤μ μ„¤μ •μ΄ μ •μƒμ μΈμ§€, JPAλ¥Ό μ‚¬μ©ν•΄ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ λ€λ΅ μƒμ„±, μμ •, μ‚­μ ν•λ”μ§€ λ“±μ ν…μ¤νΈκ°€ κ°€λ¥
* λ‚΄μ¥ν• λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ‚¬μ©ν•΄ μ‹¤μ  λ°μ΄ν„°λ² μ΄μ¤λ¥΄ μ‚¬μ©ν•μ§€ μ•κ³  ν…μ¤νΈ DBλ΅ ν…μ¤νΈ κ°€λ¥
* κΈ°λ³Έμ μΌλ΅ μΈλ©”λ¨λ¦¬ μ„λ² λ””λ“ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό μ‚¬μ©
	* **μ¥μ ** : λ©”μΈ λ©”λ¨λ¦¬λ¥Ό μ£Όμ €μ¥μ†λ΅ μ‚¬μ©ν•κΈ° λ•λ¬Έμ— μ„±λ¥μ΄ λΉ λ¦„
	* **λ‹¨μ ** : λ°μ΄ν„° μ†μ‹¤ κ°€λ¥μ„±μ΄ μ΅΄μ¬ν•¨
* ν…μ¤νΈκ°€ λλ‚  λ•λ§λ‹¤ μλ™μΌλ΅ ν…μ¤νΈμ— μ‚¬μ©ν• λ°μ΄ν„°λ¥Ό λ΅¤λ°±ν•κΈ° λ•λ¬Έμ—, ν…μ¤νΈ μ‹¤ν–‰ ν›„ μ‹¤μ  λ°μ΄ν„°κ°€ λ³€κ²½λμ—λ”μ§€ κ±±μ •ν•  ν•„μ” μ—†μ΄ ν…μ¤νΈλ¥Ό μ§„ν–‰ν•  μ μμ
* μ–΄λ…Έν…μ΄μ… μ„¤μ •μ΄λ‚ ν”„λ΅νΌν‹° μ„¤μ •μΌλ΅ μ–΄λ–¤ ν…μ¤νΈ DBλ¥Ό μ‚¬μ©ν• μ§€ μ„ νƒν•  μ μμ

#### β… `@RestClientTest`
REST κ΄€λ ¨ ν…μ¤νΈ μ–΄λ…Έν…μ΄μ…. REST ν†µμ‹ μ λ°μ΄ν„°ν•μΌλ΅ μ‚¬μ©λλ” JSON ν•μ‹μ΄ μμƒλ€λ΅ μ‘λ‹µμ„ λ°ν™ν•λ”μ§€ λ“±μ„ ν…μ¤νΈ
* ν…μ¤νΈ λ€μƒμ΄ λλ” λΉμ„ μ£Όμ… λ°›μΌλ©°, νλΌλ―Έν„°λ΅ μ£Όμ…λ°›μ§€ λ»ν•λ©΄ β€λΉμ΄ μ—†λ‹¤β€™λ” μ—λ¬ λ°μƒ
* `@Rule`λ΅ μ§€μ •ν• ν•„λ“ κ°’(ν”„λ΅νΌν‹°)μ€ ν•λ‚μ ν…μ¤νΈ λ©”μ„λ“κ°€ λλ‚  λ•λ§λ‹¤ μ •μν• κ°’μΌλ΅ μ΄κΈ°ν™”μ‹μΌμ¤

#### β… `@JsonTest`
JSONμ serializationκ³Ό deserializationμ„ μν–‰ν•λ” λΌμ΄λΈλ¬λ¦¬μΈ `Gson`κ³Ό `Jackson API` ν…μ¤νΈλ¥Ό μ κ³µ
