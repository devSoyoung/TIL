# [TIL] 2020-04-12

## π μ¤ν”„λ§ ν”„λ μ„μ›ν¬ μ…λ¬Έ κ°•μ: AOP μ μ© μμ 
* μ• λ…Έν…μ΄μ…λ§ λ³΄λ©΄ AOP μ μ©μ΄ μ–΄λ–»κ² λλ”μ§€ μ•κΈ° μ–΄λ µλ‹¤.
* `@Transactional` : AAAA μλ¦¬μ—μ„ Auto Commitμ„ false ν•κ³ , BBBB μλ¦¬μ—μ„ Commitμ„ ν•λ‹¤. κ·Έ μ‚¬μ΄ μμ—­μ€ try-catchλ΅ λ¬¶κ³ , catch κµ¬λ¬Έμ—μ„ λ΅¤λ°±ν•λ‹¤.
* μ¤ν”„λ§ Data JPAκ°€ μ κ³µν•λ” λ¨λ“  λ©”μ†λ“μ—λ” μƒλµλμ–΄ μλ‹¤ ν•λ”λΌλ„ κΈ°λ³Έμ μΌλ΅ `@Transactional`μ΄ μ μ©λμ–΄ μλ‹¤.
* νΉμ • μ• λ…Έν…μ΄μ…μ΄ λ¶™μ€ λ©”μ„λ“μ μ‹¤ν–‰μ‹κ°„μ„ μΈ΅μ •ν•λ” μ½”λ“ λ§λ“¤κΈ°
* Spring Beanλ§ Aspectκ°€ λ  μ μμ(`@Component` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©ν•΄μ„ BeanμΌλ΅ λ“±λ΅ν•΄μ•Ό ν•¨)
	* `@Aspect` μ–΄λ…Έν…μ΄μ…μ„ μ‚¬μ©
* `Throwable` : μμ™Έ μ²λ¦¬λ¥Ό ν•  μ μλ” μµμƒμ„ ν΄λμ¤. `Exception`κ³Ό `Error`μ€ `Throwable`μ μƒμ†μ„ λ°›λ”λ‹¤. [[μ°Έκ³ ]](https://sjh836.tistory.com/122)

### π“ μ‹¤μ  Aspect κµ¬ν„ μ½”λ“
```java
@Component
@Aspect
public class LogAspect {

  Logger logger = LoggerFactory.getLogger(LogAspect.class);
  
  @Around(β€@annotation(LogExecutionTime)β€)
  public Object logExecutionTime(ProceedingJoinPoint joinPoint) throws Throwable {
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();
    
    Object ret = joinPoint.proceed();

    stopWatch.stop();
    logger.info(stopWatch.preetyPrint());

    return ret;
  }
}
```

> μ–΄λ“λ°”μ΄μ¤ μ¤‘ `Around`λ§  `JoinPoint`λ¥Ό μƒμ†λ°›μ€ `ProceedingJoinPoint`λ¥Ό μΈμλ΅ μ„ μ–Έν•΄μ•Ό ν•λ‹¤. `ProceedingJoinPoint`μ—λ” `proceed()` λ“±μ΄ μ¶”κ°€λ΅ κµ¬ν„λμ–΄ μλ‹¤.   
> λ‹¤λ¥Έ μ–΄λ“λ°”μ΄μ¤λ” νΉμ • μ‹μ μ— μ‹¤ν–‰λκΈ° λ•λ¬Έμ— `proceed()`κ°€ ν•„μ”μ—†λ”λ° `Around` μ–΄λ“λ°”μ΄μ¤λ” μ „/ν›„λ΅ μ‹¤ν–‰λκΈ° λ•λ¬Έμ— μ¤‘κ°„μ„ κµ¬λ¶„ν•΄ μ¤„ ν•„μ”κ°€ μμ–΄μ„ μΈ λ“―.  

### π“ μ¶”κ°€λ΅ μ°Ύμ•„λ³Έ κ²ƒ
* IoCκ°€ λ‚®μ€ κ²°ν•©λ„μ™€ κ΄€λ ¨λ κ²ƒμ΄λΌλ©΄ AOPλ” λ†’μ€ μ‘μ§‘λ„μ™€ κ΄€λ ¨μ΄ μλ‹¤.
* λΉ„μ¦λ‹μ¤ ν•µμ‹¬ λ΅μ§μ€ μ•„λ‹μ§€λ§ κΌ­ ν•„μ”ν•κ³ , κ³µν†µν™” ν•  μ μλ” λ¶€λ¶„μ„ λ”°λ΅ λΉΌμ„(ν΅λ‹¨ λ¶„λ¦¬) κ΄€λ¦¬ν•λ” κ²ƒ
* `JoinPoint` μΈν„°νμ΄μ¤ : ν΄λΌμ΄μ–ΈνΈκ°€ νΈμ¶ν• λΉ„μ¦λ‹μ¤ λ©”μ†λ“μ μ •λ³΄λ¥Ό Aspectλ΅ μ „λ‹¬ν•΄μ£Όλ” APIκ°€ κµ¬ν„λμ–΄ μλ‹¤.
	* ν™μ© μ) μμ™Έκ°€ λ°μƒν–μ„ λ•, μμ™Έκ°€ λ°μƒν• λ©”μ†λ“μ μ΄λ¦„μ΄ λ­”μ§€ λ“±μ„ κΈ°λ΅ν•  μ μμ
	* `getSignature()`
	* `getTarget()` : νΈμ¶ν• λΉ„μ¦λ‹μ¤ λ©”μ†λ“μ κ°μ²΄ λ¦¬ν„΄
	* `getArgs()` : λ©”μ†λ“λ¥Ό νΈμ¶ν•  λ• λ„κ²¨μ¤€ μΈμ λ©λ΅
	* `getName()` : νΈμ¶ν• λ©”μ†λ“ μ΄λ¦„
	* `toLongString()` : νΈμ¶ν• λ©”μ„λ“μ μ‹κ·Έλ‹μ² + ν¨ν‚¤μ§€ κ²½λ΅ λ¦¬ν„΄
	* `toShortString()` : νΈμ¶ν• λ©”μ„λ“μ μ‹κ·Έλ‹μ² μ¶•μ•½ν• λ¬Έμμ—΄

#### β… AOP μ©μ–΄
> **Ref** : [Spring AOP (κ°λ…, μ©μ–΄, μ›λ¦¬, ν¬μΈνΈμ»· ν‘ν„μ‹, JoinPoint API)](https://sjh836.tistory.com/157)  

* **μ΅°μΈν¬μΈνΈ(Join Point)** : ν΄λΌμ΄μ–ΈνΈκ°€ νΈμ¶ν•λ” λ¨λ“  λΉ„μ¦λ‹μ¤ λ©”μ†λ“
* **ν¬μΈνΈμ»·(Point Cut)** : νΉμ • μ΅°κ±΄μ— μν•΄ ν•„ν„°λ§ λ μ΅°μΈν¬μΈνΈ. μ΅°μΈν¬μΈνΈ μ¤‘μ—μ„ νΉμ • λ©”μ†λ“λ§ AOP κΈ°λ¥μ„ μν–‰μ‹ν‚¤κΈ° μ„ν•΄μ„ μ‚¬μ©
* **μ–΄λ“λ°”μ΄μ¤(Advice)** : **κ³µν†µ κΈ°λ¥μ„ κµ¬ν„ν• λ©”μ„λ“(μ½”λ“)**
	* **Before** : λ©”μ†λ“ μ‹¤ν–‰ μ „μ— λ™μ‘
	* **After** : λ©”μ†λ“ μ‹¤ν–‰ ν›„μ— λ™μ‘
	* **After-returning** : λ©”μ†λ“κ°€ μ •μƒμ μΌλ΅ μ‹¤ν–‰λ ν›„μ— λ™μ‘
	* **After-throwing** : μμ™Έκ°€ λ°μƒν• ν›„μ— λ™μ‘
	* **Around** : λ©”μ†λ“ νΈμ¶ μ΄μ „, μ΄ν›„, μμ™Έλ°μƒ λ“± λ¨λ“  μ‹μ μ—μ„ λ™μ‘
* **μ„λΉ™(Weaving)** : ν¬μΈνΈμ»·μ΄ νΈμ¶λ  λ•, μ–΄λ“λ°”μ΄μ¤κ°€ μ‚½μ…λλ” κ³Όμ •
* **μ• μ¤ν™νΈ(Aspect)** : ν¬μΈνΈμ»·κ³Ό μ–΄λ“λ°”μ΄μ¤μ κ²°ν•©. μ–΄λ–¤ ν¬μΈνΈμ»· λ©”μ†λ“μ— λ€ν•΄ μ–΄λ–¤ μ–΄λ“λ°”μ΄μ¤ λ©”μ†λ“λ¥Ό μ‹¤ν–‰ν• μ§€ κ²°μ •
